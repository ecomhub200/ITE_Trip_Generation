<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ITE Trip Generation Analyzer - Henrico County</title>
  <link rel="stylesheet" href="assets/css/styles.css">
  <style>
    /* Additional inline critical styles */
    .main-content {
      padding-bottom: 2rem;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <div>
          <h1>ITE Trip Generation Analyzer</h1>
          <p class="header-subtitle">Henrico County, Virginia - Transportation Planning Tool</p>
        </div>
        <div class="header-badge">
          ITE 12th Edition
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="container">
      <!-- Input Form Section -->
      <section class="card" id="input-section">
        <div class="card-header">
          <h2 class="card-title">Development Information</h2>
          <div class="card-icon">1</div>
        </div>

        <form id="trip-form">
          <!-- Parcel Information -->
          <div class="grid grid-3">
            <div class="form-group">
              <label class="form-label" for="parcel-type">Parcel Type</label>
              <select class="form-select" id="parcel-type" name="parcelType">
                <option value="REZ">REZ (Rezoning)</option>
                <option value="PUP">PUP (Provisional Use Permit)</option>
                <option value="SIA">SIA (Substantial In Accord)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label form-label-required" for="parcel-number">Parcel Number</label>
              <input type="text" class="form-input" id="parcel-number" name="parcelNumber"
                     placeholder="e.g., 2026-00001" required>
            </div>
          </div>

          <!-- Development Name -->
          <div class="form-group">
            <label class="form-label" for="dev-name">Development Name (Optional)</label>
            <input type="text" class="form-input" id="dev-name" name="devName"
                   placeholder="e.g., Riverside Apartments, Main Street Shopping Center">
          </div>

          <!-- ITE Code Selection -->
          <div class="form-group">
            <label class="form-label form-label-required" for="ite-search">ITE Land Use Code</label>
            <div class="ite-search-container">
              <div class="ite-search-input-group">
                <input type="text" class="form-input" id="ite-search"
                       placeholder="Search by code or name (e.g., 210, Single-Family, Apartment)..."
                       autocomplete="off">
                <button type="button" class="btn btn-outline btn-browse-all" id="browse-all-btn" title="Browse all ITE codes">
                  Browse All
                </button>
              </div>
              <div class="ite-search-results" id="ite-results"></div>
            </div>
            <input type="hidden" id="ite-code" name="iteCode" required>
            <p class="form-helper" id="ite-selected">No ITE code selected</p>
          </div>

          <!-- Size Input -->
          <div class="form-group">
            <label class="form-label form-label-required" for="size">Development Size</label>
            <div class="input-group">
              <input type="number" class="form-input" id="size" name="size"
                     min="1" step="1" placeholder="Enter size/quantity" required>
              <select class="form-select" id="unit-display" disabled>
                <option value="">Select ITE code first</option>
              </select>
            </div>
            <p class="form-helper">Enter the number of units, 1000 SF, or other applicable measure</p>
          </div>

          <!-- Trip Mode Selection -->
          <div class="form-group">
            <label class="form-label">Trip Generation Mode</label>
            <div class="mode-selector">
              <label class="mode-checkbox mode-primary">
                <input type="radio" id="mode-vehicle" name="modes" value="vehicle" checked>
                <span class="mode-label">
                  <span class="mode-icon">&#128663;</span>
                  Vehicle
                  <span class="mode-source">11th Ed</span>
                </span>
              </label>
              <label class="mode-checkbox">
                <input type="radio" id="mode-person" name="modes" value="person">
                <span class="mode-label">
                  <span class="mode-icon">&#128694;</span>
                  Person
                  <span class="mode-source">12th Ed</span>
                </span>
              </label>
              <label class="mode-checkbox">
                <input type="radio" id="mode-walk" name="modes" value="walk">
                <span class="mode-label">
                  <span class="mode-icon">&#128694;</span>
                  Pedestrian
                  <span class="mode-source">12th Ed</span>
                </span>
              </label>
              <label class="mode-checkbox">
                <input type="radio" id="mode-bicycle" name="modes" value="bicycle">
                <span class="mode-label">
                  <span class="mode-icon">&#128690;</span>
                  Bicycle
                  <span class="mode-source">12th Ed</span>
                </span>
              </label>
              <label class="mode-checkbox">
                <input type="radio" id="mode-transit" name="modes" value="transit">
                <span class="mode-label">
                  <span class="mode-icon">&#128652;</span>
                  Transit
                  <span class="mode-source">12th Ed</span>
                </span>
              </label>
            </div>
            <p class="form-helper" id="mode-helper">Vehicle mode selected (default).</p>
          </div>

          <!-- Info Box -->
          <div class="info-box">
            <div class="info-box-icon">i</div>
            <div class="info-box-content">
              <strong>How this works:</strong> This tool uses ITE Trip Generation Manual data
              to estimate trips for your proposed development. Vehicle rates use 11th Edition data;
              pedestrian, bicycle, and transit rates use 12th Edition Modal Data. Results include
              weekday daily trips and AM/PM peak hour trips with directional splits.
            </div>
          </div>

          <!-- Submit Button -->
          <div class="btn-group">
            <button type="submit" class="btn btn-primary btn-lg" id="calculate-btn">
              Generate Trip Analysis
            </button>
            <button type="button" class="btn btn-outline" id="clear-btn">
              Clear Form
            </button>
          </div>
        </form>
      </section>

      <!-- Results Section (Hidden initially) -->
      <section class="card results-section" id="results-section">
        <div class="results-header">
          <h2 class="mb-0">Trip Generation Analysis Results</h2>
          <p class="mb-0 mt-1" id="results-subtitle">Loading...</p>
        </div>

        <!-- Threshold Status -->
        <div id="threshold-status"></div>

        <!-- Summary Statistics -->
        <div class="results-summary" id="results-summary"></div>

        <!-- Trip Details Grid -->
        <h3>Trip Generation Details</h3>
        <div class="trip-grid" id="trip-details"></div>

        <!-- Executive Summary -->
        <div class="executive-summary">
          <p class="executive-summary-title">Executive Summary</p>
          <p class="executive-summary-text" id="executive-summary-text"></p>
        </div>

        <!-- Data Quality -->
        <h3>Data Quality Assessment</h3>
        <div class="quality-grid" id="quality-grid"></div>

        <!-- Threshold Details Table -->
        <h3 class="mt-4">Threshold Analysis</h3>
        <div class="table-wrapper">
          <table class="table" id="threshold-table">
            <thead>
              <tr>
                <th>Threshold</th>
                <th>Limit</th>
                <th>Actual</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="threshold-tbody"></tbody>
          </table>
        </div>

        <!-- Calculation Details -->
        <h3 class="mt-4">Calculation Details</h3>
        <div id="calculation-details"></div>

        <!-- Hourly Distribution Section (Enhanced Accuracy) -->
        <div id="hourly-distribution-section" class="mt-4">
          <h3>
            24-Hour Trip Distribution
            <span class="badge badge-info" id="tod-source-badge">ITE Data</span>
          </h3>
          <p class="text-muted mb-2" id="tod-description">
            Hourly breakdown based on ITE Time-of-Day data for more accurate traffic analysis.
          </p>

          <!-- Day Type Selector -->
          <div class="form-group mb-2" id="day-type-selector" style="max-width: 300px;">
            <label class="form-label">Day Type</label>
            <select class="form-select" id="day-type-select">
              <option value="weekday">Weekday</option>
              <option value="saturday">Saturday</option>
              <option value="sunday">Sunday</option>
            </select>
          </div>

          <!-- Hourly Chart (Bar Chart visualization) -->
          <div class="hourly-chart-container">
            <div id="hourly-chart" class="hourly-chart"></div>
          </div>

          <!-- Peak Hour Summary -->
          <div class="peak-summary-grid" id="peak-summary">
            <div class="peak-summary-item">
              <div class="peak-label">AM Peak Hour</div>
              <div class="peak-time" id="am-peak-time">7:00 - 8:00 AM</div>
              <div class="peak-trips" id="am-peak-trips">0 trips</div>
              <div class="peak-split" id="am-peak-split">50% in / 50% out</div>
            </div>
            <div class="peak-summary-item">
              <div class="peak-label">PM Peak Hour</div>
              <div class="peak-time" id="pm-peak-time">5:00 - 6:00 PM</div>
              <div class="peak-trips" id="pm-peak-trips">0 trips</div>
              <div class="peak-split" id="pm-peak-split">50% in / 50% out</div>
            </div>
            <div class="peak-summary-item">
              <div class="peak-label">Overall Peak</div>
              <div class="peak-time" id="overall-peak-time">5:00 - 6:00 PM</div>
              <div class="peak-trips" id="overall-peak-trips">0 trips</div>
              <div class="peak-split" id="overall-peak-split">50% in / 50% out</div>
            </div>
          </div>

          <!-- Hourly Table (Collapsible) -->
          <details class="hourly-table-details mt-2">
            <summary class="hourly-table-summary">View Detailed Hourly Table</summary>
            <div class="table-wrapper mt-2">
              <table class="table table-compact" id="hourly-table">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Total Trips</th>
                    <th>Entering</th>
                    <th>Exiting</th>
                    <th>% of Daily</th>
                  </tr>
                </thead>
                <tbody id="hourly-tbody"></tbody>
              </table>
            </div>
          </details>
        </div>

        <!-- Export Buttons -->
        <div class="btn-group mt-4 no-print">
          <button type="button" class="btn btn-save" id="save-analysis-btn">
            Save Analysis
          </button>
          <button type="button" class="btn btn-success" id="export-excel-btn">
            Download Excel Report
          </button>
          <button type="button" class="btn btn-outline" id="print-btn">
            Print / Save as PDF
          </button>
          <button type="button" class="btn btn-outline" id="new-analysis-btn">
            New Analysis
          </button>
        </div>
      </section>

      <!-- Saved Analyses Section -->
      <section class="card no-print" id="saved-analyses-section">
        <div class="card-header">
          <h2 class="card-title">
            Saved Analyses
            <span class="saved-count" id="saved-count">(0)</span>
          </h2>
          <div class="btn-group">
            <button type="button" class="btn btn-sm btn-outline" id="toggle-saved">
              Show Saved
            </button>
            <button type="button" class="btn btn-sm btn-danger hidden" id="clear-all-btn">
              Clear All
            </button>
          </div>
        </div>
        <div id="saved-analyses-content" class="hidden">
          <div class="search-box">
            <input type="text" class="form-input" id="saved-search"
                   placeholder="Search by parcel ID, ITE code, or development name...">
          </div>
          <div class="saved-analyses-list" id="saved-analyses-list">
            <div class="empty-state">
              <div class="empty-state-icon">&#128451;</div>
              <p>No saved analyses yet</p>
              <p class="text-muted">Run an analysis and click "Save Analysis" to store it here</p>
            </div>
          </div>
        </div>
      </section>

      <!-- ITE Code Reference (Collapsible) -->
      <section class="card no-print">
        <div class="card-header">
          <h2 class="card-title">ITE Code Quick Reference</h2>
          <button type="button" class="btn btn-sm btn-outline" id="toggle-reference">
            Show All Codes
          </button>
        </div>
        <div id="ite-reference" class="hidden">
          <div id="ite-categories"></div>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer no-print">
    <div class="container">
      <p>
        ITE Trip Generation Analyzer | Based on ITE Trip Generation Manual, 12th Edition<br>
        Henrico County Department of Planning |
        <span id="current-year"></span>
      </p>
      <p class="mt-1 text-muted">
        This tool provides estimates for planning purposes. Always verify calculations against
        official ITE documentation for final submissions.
      </p>
    </div>
  </footer>

  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>

  <!-- Confirmation Dialog -->
  <div class="dialog-overlay" id="dialog-overlay">
    <div class="dialog">
      <h3 class="dialog-title" id="dialog-title">Confirm Action</h3>
      <p class="dialog-message" id="dialog-message">Are you sure you want to proceed?</p>
      <div class="dialog-actions">
        <button type="button" class="btn btn-outline" id="dialog-cancel">Cancel</button>
        <button type="button" class="btn btn-danger" id="dialog-confirm">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="assets/js/ite-database.js"></script>
  <script src="assets/js/modal-data.js"></script>
  <script src="assets/js/calculator.js"></script>
  <script src="assets/js/storage.js"></script>
  <script src="assets/js/export.js"></script>
  <script src="assets/js/ui.js"></script>
  <script src="assets/js/chat.js"></script>
</body>
</html>
